<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shadow Slave Fan Fiction Hub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-dark: #0a0a0f;
            --secondary-dark: #12121f;
            --accent-color: #9d4edd;
            --accent-secondary: #7b2cbf;
            --text-primary: #f0f0f0;
            --text-secondary: #b0b0c0;
            --border-color: #2a2a3a;
            --shadow-color: rgba(157, 78, 221, 0.2);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--primary-dark);
            color: var(--text-primary);
            line-height: 1.6;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(157, 78, 221, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(157, 78, 221, 0.05) 0%, transparent 20%);
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Header Styles */
        header {
            background-color: var(--secondary-dark);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }
        
        .logo-icon {
            color: var(--accent-color);
            font-size: 28px;
        }
        
        .logo-text {
            font-family: 'Cinzel', serif;
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(to right, var(--accent-color), #c77dff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .logo-subtitle {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: -5px;
        }
        
        nav ul {
            display: flex;
            list-style: none;
            gap: 25px;
        }
        
        nav a {
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 400;
            font-size: 16px;
            transition: color 0.3s;
            position: relative;
            cursor: pointer;
        }
        
        nav a:hover {
            color: var(--accent-color);
        }
        
        nav a.active {
            color: var(--accent-color);
            font-weight: 700;
        }
        
        nav a.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--accent-color);
        }
        
        .user-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .user-info {
            display: none;
            align-items: center;
            gap: 10px;
        }
        
        .user-info.active {
            display: flex;
        }
        
        .username {
            color: var(--accent-color);
            font-weight: 600;
        }
        
        .btn {
            padding: 8px 18px;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            font-family: 'Lato', sans-serif;
        }
        
        .btn-primary {
            background-color: var(--accent-color);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--accent-secondary);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px var(--shadow-color);
        }
        
        .btn-outline {
            background-color: transparent;
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
        }
        
        .btn-outline:hover {
            background-color: rgba(157, 78, 221, 0.1);
        }
        
        .btn-small {
            padding: 5px 12px;
            font-size: 14px;
        }
        
        /* Hero Section */
        .hero {
            padding: 60px 0;
            background: linear-gradient(to bottom, rgba(10, 10, 15, 0.9), var(--primary-dark)), 
                        url('https://images.unsplash.com/photo-1519681393784-d120267933ba?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80');
            background-size: cover;
            background-position: center;
            border-bottom: 1px solid var(--border-color);
        }
        
        .hero-content {
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .hero h1 {
            font-family: 'Cinzel', serif;
            font-size: 3rem;
            margin-bottom: 15px;
            background: linear-gradient(to right, #fff, var(--accent-color));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .hero p {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 30px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* Main Content */
        main {
            padding: 50px 0;
            min-height: 600px;
        }
        
        .section-title {
            font-family: 'Cinzel', serif;
            font-size: 2rem;
            margin-bottom: 30px;
            color: var(--text-primary);
            position: relative;
            display: inline-block;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 60px;
            height: 3px;
            background-color: var(--accent-color);
        }
        
        /* Page Sections */
        .page-section {
            display: none;
        }
        
        .page-section.active {
            display: block;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background-color: var(--secondary-dark);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .empty-state-icon {
            font-size: 64px;
            color: var(--accent-color);
            margin-bottom: 20px;
        }
        
        .empty-state h3 {
            font-family: 'Cinzel', serif;
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: var(--text-primary);
        }
        
        .empty-state p {
            color: var(--text-secondary);
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto 30px;
        }
        
        /* Filters */
        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 8px 16px;
            background-color: var(--secondary-dark);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .filter-btn:hover, .filter-btn.active {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }
        
        /* Fanfic Cards */
        .fanfics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
        }
        
        .fanfic-card {
            background-color: var(--secondary-dark);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--border-color);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .fanfic-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px var(--shadow-color);
            border-color: var(--accent-color);
        }
        
        .fanfic-image {
            height: 180px;
            background: linear-gradient(to bottom right, #1a1a2e, var(--accent-secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
        }
        
        .fanfic-content {
            padding: 20px;
        }
        
        .fanfic-title {
            font-family: 'Cinzel', serif;
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--text-primary);
        }
        
        .fanfic-author {
            color: var(--accent-color);
            font-size: 0.9rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .fanfic-summary {
            color: var(--text-secondary);
            font-size: 0.95rem;
            margin-bottom: 15px;
            line-height: 1.5;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .fanfic-meta {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 0.85rem;
            border-top: 1px solid var(--border-color);
            padding-top: 15px;
        }
        
        /* Reader Page - FIXED TEXT VISIBILITY */
        .reader-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .reader-title {
            font-family: 'Cinzel', serif;
            font-size: 2.2rem;
            color: var(--text-primary);
        }
        
        .reader-subtitle {
            color: var(--accent-color);
            font-size: 1.1rem;
            margin-top: 5px;
        }
        
        .chapter-selector {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            padding: 15px;
            background-color: var(--secondary-dark);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .chapter-nav {
            display: flex;
            gap: 10px;
        }
        
        .chapter-content {
            background-color: var(--secondary-dark);
            border-radius: 8px;
            padding: 40px;
            border: 1px solid var(--border-color);
            line-height: 1.8;
            font-size: 1.1rem;
            min-height: 400px;
            color: var(--text-primary) !important; /* FORCE TEXT COLOR */
        }
        
        .chapter-text {
            white-space: pre-wrap;
            font-family: 'Lato', sans-serif;
            color: var(--text-primary) !important;
            font-size: 1.1rem;
            line-height: 1.8;
        }
        
        .chapter-text p {
            margin-bottom: 24px;
            color: var(--text-primary) !important;
        }
        
        .chapter-content h3 {
            color: var(--accent-color) !important;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 15px;
            font-family: 'Cinzel', serif;
        }
        
        /* Add Fanfic Form */
        .add-fanfic-form, .login-form, .signup-form {
            background-color: var(--secondary-dark);
            border-radius: 8px;
            padding: 30px;
            border: 1px solid var(--border-color);
            margin-bottom: 50px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-form {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .close-form:hover {
            color: var(--accent-color);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 600;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border-color);
            border-radius: 4px;
            color: var(--text-primary);
            font-family: 'Lato', sans-serif;
            font-size: 16px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--accent-color);
        }
        
        textarea.form-control {
            min-height: 150px;
            resize: vertical;
        }
        
        .form-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        /* Modal Overlay */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background-color: var(--secondary-dark);
            border-radius: 8px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
        }
        
        /* Add Chapter Form */
        .add-chapter-form {
            background-color: var(--secondary-dark);
            border-radius: 8px;
            padding: 30px;
            border: 1px solid var(--border-color);
            margin-top: 30px;
            display: none;
        }
        
        .add-chapter-form.active {
            display: block;
        }
        
        /* Footer */
        footer {
            background-color: var(--secondary-dark);
            border-top: 1px solid var(--border-color);
            padding: 40px 0 20px;
        }
        
        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 40px;
            margin-bottom: 30px;
        }
        
        .footer-section h3 {
            font-family: 'Cinzel', serif;
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: var(--text-primary);
        }
        
        .footer-section ul {
            list-style: none;
        }
        
        .footer-section ul li {
            margin-bottom: 10px;
        }
        
        .footer-section ul li a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.3s;
        }
        
        .footer-section ul li a:hover {
            color: var(--accent-color);
        }
        
        .copyright {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.9rem;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            nav ul {
                gap: 15px;
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .hero h1 {
                font-size: 2.2rem;
            }
            
            .hero p {
                font-size: 1rem;
            }
            
            .fanfics-grid {
                grid-template-columns: 1fr;
            }
            
            .footer-content {
                flex-direction: column;
                gap: 30px;
            }
            
            .chapter-content {
                padding: 20px;
            }
            
            .reader-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
        
        /* TEST OVERLAY - Will help us see if content is there */
        #test-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 0, 0, 0.1);
            pointer-events: none;
            z-index: 9999;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Test Overlay -->
    <div id="test-overlay"></div>
    
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo" id="homeBtn">
                    <div class="logo-icon">
                        <i class="fas fa-moon"></i>
                    </div>
                    <div>
                        <div class="logo-text">Shadow Slave Fan Fiction Hub</div>
                        <div class="logo-subtitle">Unofficial Community Platform</div>
                    </div>
                </div>
                
                <nav>
                    <ul>
                        <li><a href="#" class="nav-link active" data-page="home">Home</a></li>
                        <li><a href="#" class="nav-link" data-page="library">Library</a></li>
                        <li><a href="#" class="nav-link" data-page="my-fics">My Fics</a></li>
                    </ul>
                </nav>
                
                <div class="user-actions">
                    <div class="user-info" id="userInfo">
                        <span class="username" id="usernameDisplay">Guest</span>
                        <button class="btn btn-outline btn-small" id="logoutBtn">Log Out</button>
                    </div>
                    <button class="btn btn-outline" id="loginBtn">Log In</button>
                    <button class="btn btn-primary" id="signupBtn">Sign Up</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Login Modal -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal-content">
            <div class="form-header">
                <h2 class="section-title">Log In</h2>
                <button class="close-form" id="closeLogin">&times;</button>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginUsername">Username</label>
                    <input type="text" id="loginUsername" class="form-control" placeholder="Enter your username" required>
                </div>
                
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="Enter your password" required>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Log In</button>
                    <button type="button" class="btn btn-outline" id="switchToSignup">Create Account</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Signup Modal -->
    <div class="modal-overlay" id="signupModal">
        <div class="modal-content">
            <div class="form-header">
                <h2 class="section-title">Sign Up</h2>
                <button class="close-form" id="closeSignup">&times;</button>
            </div>
            <form id="signupForm">
                <div class="form-group">
                    <label for="signupUsername">Username</label>
                    <input type="text" id="signupUsername" class="form-control" placeholder="Choose a username" required>
                </div>
                
                <div class="form-group">
                    <label for="signupEmail">Email</label>
                    <input type="email" id="signupEmail" class="form-control" placeholder="Enter your email" required>
                </div>
                
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" class="form-control" placeholder="Choose a password (min 6 characters)" required>
                </div>
                
                <div class="form-group">
                    <label for="confirmPassword">Confirm Password</label>
                    <input type="password" id="confirmPassword" class="form-control" placeholder="Confirm your password" required>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Sign Up</button>
                    <button type="button" class="btn btn-outline" id="switchToLogin">Already have an account?</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Hero Section (Home Page) -->
    <section class="hero page-section active" id="home-page">
        <div class="container">
            <div class="hero-content">
                <h1>Welcome to the Shadow Slave Fan Fiction Hub</h1>
                <p>Create, share, and read fan fiction set in the Shadow Slave universe. Write your own tales of Nephis, Sunny, Cassie and the Nightmare Spell.</p>
                <button class="btn btn-primary" id="addFanficBtn">Start Writing</button>
            </div>
        </div>
    </section>

    <!-- Main Content Area -->
    <main class="container">
        <!-- Home Page Content -->
        <div class="page-section active" id="home-content">
            <h2 class="section-title">Community Fan Fictions</h2>
            
            <!-- Filter Buttons -->
            <div class="filters">
                <button class="filter-btn active" data-filter="all">All Stories</button>
                <button class="filter-btn" data-filter="sunny">Sunny-centric</button>
                <button class="filter-btn" data-filter="nephis">Nephis-centric</button>
                <button class="filter-btn" data-filter="cassie">Cassie-centric</button>
                <button class="filter-btn" data-filter="ensemble">Ensemble</button>
                <button class="filter-btn" data-filter="alternate">Alternate Universe</button>
            </div>
            
            <!-- Fanfics Grid -->
            <div class="fanfics-grid" id="fanficsContainer">
                <!-- Empty state by default -->
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-book-open"></i>
                    </div>
                    <h3>No Fan Fictions Yet</h3>
                    <p>Be the first to write a Shadow Slave fan fiction! Share your story with the community.</p>
                    <button class="btn btn-primary" id="addFirstFanficBtn">Write Your First Story</button>
                </div>
            </div>
        </div>
        
        <!-- Library Page -->
        <div class="page-section" id="library-page">
            <h2 class="section-title">Fan Fiction Library</h2>
            
            <div class="filters">
                <button class="filter-btn active" data-filter="all">All Stories</button>
                <button class="filter-btn" data-filter="sunny">Sunny-centric</button>
                <button class="filter-btn" data-filter="nephis">Nephis-centric</button>
                <button class="filter-btn" data-filter="cassie">Cassie-centric</button>
                <button class="filter-btn" data-filter="ensemble">Ensemble</button>
                <button class="filter-btn" data-filter="alternate">Alternate Universe</button>
            </div>
            
            <div class="fanfics-grid" id="libraryContainer">
                <!-- Empty state by default -->
                <div class="empty-state">
                    <div class="empty-state-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <h3>Library is Empty</h3>
                    <p>No one has published any fan fiction yet. Be the first to share your story!</p>
                    <button class="btn btn-primary" id="addFirstFanficLibraryBtn">Write First Story</button>
                </div>
            </div>
        </div>
        
        <!-- My Fics Page -->
        <div class="page-section" id="my-fics-page">
            <div id="myFicsContainer">
                <h2 class="section-title">My Fan Fictions</h2>
                
                <div class="fanfics-grid" id="myFicsList">
                    <!-- Empty state by default -->
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-feather"></i>
                        </div>
                        <h3>No Stories Yet</h3>
                        <p>You haven't created any fan fictions yet. Start writing your first Shadow Slave story!</p>
                        <button class="btn btn-primary" id="addFanficFromMyFics">Start Writing</button>
                    </div>
                </div>
                
                <!-- Add Chapter Form (for existing fics) -->
                <div class="add-chapter-form" id="addChapterForm">
                    <h3 class="section-title">Add New Chapter</h3>
                    <form id="chapterForm">
                        <div class="form-group">
                            <label for="chapterTitle">Chapter Title</label>
                            <input type="text" id="chapterTitle" class="form-control" placeholder="Enter chapter title" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="chapterContent">Chapter Content</label>
                            <textarea id="chapterContent" class="form-control" placeholder="Write your chapter here..." rows="15" required></textarea>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Add Chapter</button>
                            <button type="button" class="btn btn-outline" id="cancelChapterBtn">Cancel</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Reader Page -->
        <div class="page-section" id="reader-page">
            <div class="reader-header">
                <div>
                    <h1 class="reader-title" id="readerTitle">Story Title</h1>
                    <p class="reader-subtitle" id="readerAuthor">by Author</p>
                </div>
                <button class="btn btn-outline" id="backToLibrary">Back to Library</button>
            </div>
            
            <div class="chapter-selector">
                <div>
                    <strong>Chapter:</strong>
                    <select id="chapterSelect" class="form-control" style="width: auto; display: inline-block; margin-left: 10px;">
                        <option value="1">Chapter 1</option>
                    </select>
                </div>
                <div class="chapter-nav">
                    <button class="btn btn-outline" id="prevChapter"><i class="fas fa-chevron-left"></i> Previous</button>
                    <button class="btn btn-outline" id="nextChapter">Next <i class="fas fa-chevron-right"></i></button>
                </div>
            </div>
            
            <div class="chapter-content" id="chapterContent">
                <!-- TEST CONTENT - Will show if loading works -->
                <h3>Test Chapter Title</h3>
                <div class="chapter-text">
                    <p>This is a test paragraph to check if text is visible.</p>
                    <p>If you can see this text, then the styling is working.</p>
                    <p>If you cannot see this, there's a serious display issue.</p>
                </div>
            </div>
        </div>
        
        <!-- Add Fanfic Form -->
        <div class="page-section" id="add-fanfic-page">
            <div class="add-fanfic-form">
                <div class="form-header">
                    <h2 class="section-title">Create New Fan Fiction</h2>
                    <button class="close-form" id="closeAddFanfic">&times;</button>
                </div>
                <form id="fanficForm">
                    <div class="form-group">
                        <label for="title">Title</label>
                        <input type="text" id="title" class="form-control" placeholder="Enter your fan fiction title" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="summary">Summary</label>
                        <textarea id="summary" class="form-control" placeholder="Brief summary of your fan fiction (max 300 characters)" maxlength="300" required></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="category">Category</label>
                        <select id="category" class="form-control" required>
                            <option value="">Select a category</option>
                            <option value="sunny">Sunny-centric</option>
                            <option value="nephis">Nephis-centric</option>
                            <option value="cassie">Cassie-centric</option>
                            <option value="ensemble">Ensemble Cast</option>
                            <option value="alternate">Alternate Universe</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="status">Status</label>
                        <select id="status" class="form-control" required>
                            <option value="ongoing">Ongoing</option>
                            <option value="completed">Completed</option>
                            <option value="hiatus">On Hiatus</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="firstChapterTitle">First Chapter Title</label>
                        <input type="text" id="firstChapterTitle" class="form-control" placeholder="Enter title for first chapter" value="Chapter 1" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="firstChapter">First Chapter Content</label>
                        <textarea id="firstChapter" class="form-control" placeholder="Write the content of your first chapter here..." rows="15" required></textarea>
                        <small style="color: var(--text-secondary); display: block; margin-top: 5px;">Tip: Write your chapter content above. When you publish, you'll be able to read it immediately!</small>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Publish Fan Fiction</button>
                        <button type="button" class="btn btn-outline" id="cancelBtn">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Shadow Slave Hub</h3>
                    <p>An unofficial fan community dedicated to the Shadow Slave light novel by Guiltythree. All rights belong to their respective owners.</p>
                </div>
                
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#" class="nav-link" data-page="home">Home</a></li>
                        <li><a href="#" class="nav-link" data-page="library">Library</a></li>
                        <li><a href="#" class="nav-link" data-page="my-fics">My Stories</a></li>
                        <li><a href="#" id="addFanficFooter">Write New Story</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h3>Community</h3>
                    <ul>
                        <li><a href="#" id="communityGuidelines">Submission Guidelines</a></li>
                        <li><a href="#" id="aboutUs">About This Site</a></li>
                        <li><a href="#" id="reportIssue">Report Issue</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="copyright">
                <p>&copy; 2023 Shadow Slave Fan Fiction Hub. This is a fan-made website. Shadow Slave is created by Guiltythree.</p>
            </div>
        </div>
    </footer>

    <script>
        // State Management
        const state = {
            currentUser: null,
            currentPage: 'home',
            currentFanfic: null,
            currentChapter: 1,
            fanfics: [],
            users: [],
            nextFanficId: 1
        };

        // Category icons mapping
        const categoryIcons = {
            sunny: "fas fa-user-ninja",
            nephis: "fas fa-crown",
            cassie: "fas fa-eye",
            ensemble: "fas fa-users",
            alternate: "fas fa-random"
        };

        // Status text mapping
        const statusText = {
            ongoing: "Ongoing",
            completed: "Completed",
            hiatus: "On Hiatus"
        };

        // DOM elements
        const userInfo = document.getElementById('userInfo');
        const usernameDisplay = document.getElementById('usernameDisplay');
        const loginBtn = document.getElementById('loginBtn');
        const signupBtn = document.getElementById('signupBtn');
        const logoutBtn = document.getElementById('logoutBtn');
        const loginModal = document.getElementById('loginModal');
        const signupModal = document.getElementById('signupModal');
        const closeLogin = document.getElementById('closeLogin');
        const closeSignup = document.getElementById('closeSignup');
        const switchToSignup = document.getElementById('switchToSignup');
        const switchToLogin = document.getElementById('switchToLogin');
        const loginForm = document.getElementById('loginForm');
        const signupForm = document.getElementById('signupForm');
        const navLinks = document.querySelectorAll('.nav-link');
        const pageSections = document.querySelectorAll('.page-section');
        const homeBtn = document.getElementById('homeBtn');
        const addFanficBtn = document.getElementById('addFanficBtn');
        const addFirstFanficBtn = document.getElementById('addFirstFanficBtn');
        const addFirstFanficLibraryBtn = document.getElementById('addFirstFanficLibraryBtn');
        const addFanficFromMyFics = document.getElementById('addFanficFromMyFics');
        const addFanficFooter = document.getElementById('addFanficFooter');
        const fanficForm = document.getElementById('fanficForm');
        const closeAddFanfic = document.getElementById('closeAddFanfic');
        const cancelBtn = document.getElementById('cancelBtn');
        const fanficsContainer = document.getElementById('fanficsContainer');
        const libraryContainer = document.getElementById('libraryContainer');
        const myFicsList = document.getElementById('myFicsList');
        const readerPage = document.getElementById('reader-page');
        const backToLibrary = document.getElementById('backToLibrary');
        const chapterSelect = document.getElementById('chapterSelect');
        const prevChapter = document.getElementById('prevChapter');
        const nextChapter = document.getElementById('nextChapter');
        const chapterContent = document.getElementById('chapterContent');
        const readerTitle = document.getElementById('readerTitle');
        const readerAuthor = document.getElementById('readerAuthor');
        const addChapterForm = document.getElementById('addChapterForm');
        const chapterForm = document.getElementById('chapterForm');
        const cancelChapterBtn = document.getElementById('cancelChapterBtn');
        const testOverlay = document.getElementById('test-overlay');

        // Initialize from localStorage
        function initializeFromStorage() {
            console.log('Initializing from localStorage...');
            
            // Load users from localStorage
            const storedUsers = localStorage.getItem('shadowSlaveUsers');
            if (storedUsers) {
                try {
                    state.users = JSON.parse(storedUsers);
                    console.log('Loaded users:', state.users.length);
                } catch (e) {
                    console.error('Error parsing users:', e);
                    state.users = [];
                }
            }
            
            // Load fanfics from localStorage
            const storedFanfics = localStorage.getItem('shadowSlaveFanfics');
            if (storedFanfics) {
                try {
                    state.fanfics = JSON.parse(storedFanfics);
                    console.log('Loaded fanfics:', state.fanfics.length);
                    // Ensure chapters exist for each fanfic
                    state.fanfics.forEach(fanfic => {
                        if (!fanfic.chapters || !Array.isArray(fanfic.chapters)) {
                            fanfic.chapters = [];
                        }
                        console.log(`Fanfic "${fanfic.title}" has ${fanfic.chapters.length} chapters`);
                    });
                } catch (e) {
                    console.error('Error parsing fanfics:', e);
                    state.fanfics = [];
                }
            }
            
            // Load next ID from localStorage
            const storedNextId = localStorage.getItem('shadowSlaveNextId');
            if (storedNextId) {
                state.nextFanficId = parseInt(storedNextId) || 1;
            }
            
            // Check if user is logged in from localStorage
            const currentUser = localStorage.getItem('shadowSlaveCurrentUser');
            if (currentUser) {
                try {
                    state.currentUser = JSON.parse(currentUser);
                    updateUserUI();
                    console.log('User logged in:', state.currentUser.username);
                } catch (e) {
                    console.error('Error parsing current user:', e);
                }
            }
            
            // Render fanfics on home page
            renderFanfics('home');
            
            console.log('Initialization complete');
        }

        // Save to localStorage
        function saveToStorage() {
            try {
                localStorage.setItem('shadowSlaveUsers', JSON.stringify(state.users));
                localStorage.setItem('shadowSlaveFanfics', JSON.stringify(state.fanfics));
                localStorage.setItem('shadowSlaveNextId', state.nextFanficId.toString());
                if (state.currentUser) {
                    localStorage.setItem('shadowSlaveCurrentUser', JSON.stringify(state.currentUser));
                } else {
                    localStorage.removeItem('shadowSlaveCurrentUser');
                }
                console.log('Saved to localStorage');
            } catch (e) {
                console.error('Error saving to localStorage:', e);
            }
        }

        // Update user UI
        function updateUserUI() {
            if (state.currentUser) {
                userInfo.classList.add('active');
                usernameDisplay.textContent = state.currentUser.username;
                loginBtn.style.display = 'none';
                signupBtn.style.display = 'none';
            } else {
                userInfo.classList.remove('active');
                loginBtn.style.display = 'block';
                signupBtn.style.display = 'block';
            }
        }

        // Navigate to page
        function navigateTo(page) {
            console.log('Navigating to:', page);
            
            // Update active nav link
            navLinks.forEach(link => {
                if (link.getAttribute('data-page') === page) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
            
            // Hide all page sections
            pageSections.forEach(section => {
                section.classList.remove('active');
            });
            
            // Show target page
            state.currentPage = page;
            
            if (page === 'home') {
                document.getElementById('home-page').classList.add('active');
                document.getElementById('home-content').classList.add('active');
                renderFanfics('home');
            } else if (page === 'library') {
                document.getElementById('library-page').classList.add('active');
                renderFanfics('library');
            } else if (page === 'my-fics') {
                document.getElementById('my-fics-page').classList.add('active');
                renderMyFics();
            } else if (page === 'add-fanfic') {
                document.getElementById('add-fanfic-page').classList.add('active');
                if (!state.currentUser) {
                    alert('Please log in to create a fan fiction.');
                    navigateTo('home');
                    loginModal.classList.add('active');
                    return;
                }
            } else if (page === 'reader') {
                document.getElementById('reader-page').classList.add('active');
            }
        }

        // Render fanfics
        function renderFanfics(page) {
            const container = page === 'home' ? fanficsContainer : libraryContainer;
            
            if (state.fanfics.length === 0) {
                // Show empty state
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-book-open"></i>
                        </div>
                        <h3>No Fan Fictions Yet</h3>
                        <p>Be the first to write a Shadow Slave fan fiction! Share your story with the community.</p>
                        <button class="btn btn-primary" id="addFirstFanfic${page === 'home' ? 'Home' : 'Library'}Btn">Write Your First Story</button>
                    </div>
                `;
                
                // Re-add event listener for the button
                const buttonId = page === 'home' ? 'addFirstFanficHomeBtn' : 'addFirstFanficLibraryBtn';
                setTimeout(() => {
                    const button = document.getElementById(buttonId);
                    if (button) {
                        button.addEventListener('click', () => {
                            if (!state.currentUser) {
                                alert('Please log in to create a fan fiction.');
                                loginModal.classList.add('active');
                            } else {
                                navigateTo('add-fanfic');
                            }
                        });
                    }
                }, 100);
                return;
            }
            
            // Clear container
            container.innerHTML = '';
            
            // Add fanfic cards
            state.fanfics.forEach(fanfic => {
                const fanficCard = document.createElement('div');
                fanficCard.className = 'fanfic-card';
                fanficCard.dataset.id = fanfic.id;
                
                fanficCard.innerHTML = `
                    <div class="fanfic-image">
                        <i class="${categoryIcons[fanfic.category]}"></i>
                    </div>
                    <div class="fanfic-content">
                        <h3 class="fanfic-title">${fanfic.title}</h3>
                        <div class="fanfic-author">
                            <i class="fas fa-user-pen"></i> ${fanfic.author}
                        </div>
                        <p class="fanfic-summary">${fanfic.summary}</p>
                        <div class="fanfic-meta">
                            <div>
                                <i class="fas fa-layer-group"></i> ${fanfic.chapters ? fanfic.chapters.length : 0} chapter${fanfic.chapters && fanfic.chapters.length !== 1 ? 's' : ''}
                            </div>
                            <div>
                                <span class="status">${statusText[fanfic.status]}</span>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add click event to read fanfic
                fanficCard.addEventListener('click', () => {
                    console.log('Clicked fanfic:', fanfic.title, 'ID:', fanfic.id);
                    openReader(fanfic.id);
                });
                
                container.appendChild(fanficCard);
            });
        }

        // Render my fanfics
        function renderMyFics() {
            if (!state.currentUser) {
                myFicsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-sign-in-alt"></i>
                        </div>
                        <h3>Not Logged In</h3>
                        <p>Please log in to view and manage your fan fictions.</p>
                        <button class="btn btn-primary" id="loginFromMyFics">Log In</button>
                    </div>
                `;
                
                setTimeout(() => {
                    const button = document.getElementById('loginFromMyFics');
                    if (button) {
                        button.addEventListener('click', () => {
                            loginModal.classList.add('active');
                        });
                    }
                }, 100);
                return;
            }
            
            const myFanfics = state.fanfics.filter(fanfic => fanfic.authorId === state.currentUser.id);
            
            if (myFanfics.length === 0) {
                myFicsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-feather"></i>
                        </div>
                        <h3>No Stories Yet</h3>
                        <p>You haven't created any fan fictions yet. Start writing your first Shadow Slave story!</p>
                        <button class="btn btn-primary" id="addFanficFromMyFics">Start Writing</button>
                    </div>
                `;
                return;
            }
            
            // Clear container
            myFicsList.innerHTML = '';
            
            // Add fanfic cards with edit options
            myFanfics.forEach(fanfic => {
                const fanficCard = document.createElement('div');
                fanficCard.className = 'fanfic-card';
                fanficCard.dataset.id = fanfic.id;
                
                fanficCard.innerHTML = `
                    <div class="fanfic-image">
                        <i class="${categoryIcons[fanfic.category]}"></i>
                    </div>
                    <div class="fanfic-content">
                        <h3 class="fanfic-title">${fanfic.title}</h3>
                        <div class="fanfic-author">
                            <i class="fas fa-user-pen"></i> ${fanfic.author}
                        </div>
                        <p class="fanfic-summary">${fanfic.summary}</p>
                        <div class="fanfic-meta">
                            <div>
                                <i class="fas fa-layer-group"></i> ${fanfic.chapters ? fanfic.chapters.length : 0} chapter${fanfic.chapters && fanfic.chapters.length !== 1 ? 's' : ''}
                            </div>
                            <div>
                                <span class="status">${statusText[fanfic.status]}</span>
                            </div>
                        </div>
                        <div style="margin-top: 15px; display: flex; gap: 10px;">
                            <button class="btn btn-outline btn-small read-btn">Read</button>
                            <button class="btn btn-outline btn-small add-chapter-btn">Add Chapter</button>
                        </div>
                    </div>
                `;
                
                // Add click event to read fanfic
                const readBtn = fanficCard.querySelector('.read-btn');
                if (readBtn) {
                    readBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        console.log('Read button clicked for:', fanfic.title);
                        openReader(fanfic.id);
                    });
                }
                
                // Add click event to add chapter
                const addChapterBtn = fanficCard.querySelector('.add-chapter-btn');
                if (addChapterBtn) {
                    addChapterBtn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        state.currentFanfic = fanfic;
                        addChapterForm.classList.add('active');
                        addChapterForm.scrollIntoView({ behavior: 'smooth' });
                    });
                }
                
                // Card click still opens reader
                fanficCard.addEventListener('click', () => {
                    openReader(fanfic.id);
                });
                
                myFicsList.appendChild(fanficCard);
            });
        }

        // Open reader
        function openReader(fanficId) {
            console.log('=== OPENING READER ===');
            console.log('Fanfic ID:', fanficId);
            
            const fanfic = state.fanfics.find(f => f.id === fanficId);
            if (!fanfic) {
                console.error('Fanfic not found with ID:', fanficId);
                alert('Story not found!');
                return;
            }
            
            console.log('Found fanfic:', fanfic);
            console.log('Chapters:', fanfic.chapters);
            console.log('Chapter count:', fanfic.chapters ? fanfic.chapters.length : 0);
            
            state.currentFanfic = fanfic;
            state.currentChapter = 1;
            
            // Update reader UI
            readerTitle.textContent = fanfic.title;
            readerAuthor.textContent = `by ${fanfic.author}`;
            
            // Populate chapter select
            chapterSelect.innerHTML = '';
            if (fanfic.chapters && fanfic.chapters.length > 0) {
                fanfic.chapters.forEach((chapter, index) => {
                    const option = document.createElement('option');
                    option.value = index + 1;
                    option.textContent = `Chapter ${index + 1}: ${chapter.title || 'Untitled'}`;
                    chapterSelect.appendChild(option);
                });
            } else {
                // No chapters
                const option = document.createElement('option');
                option.value = 1;
                option.textContent = 'No chapters available';
                chapterSelect.appendChild(option);
            }
            
            // Load first chapter automatically
            loadChapter(1);
            
            // Navigate to reader
            navigateTo('reader');
            
            // Show test overlay to help debug
            testOverlay.style.display = 'block';
            setTimeout(() => {
                testOverlay.style.display = 'none';
            }, 1000);
        }

        // Load chapter - SIMPLIFIED AND FIXED
        function loadChapter(chapterNumber) {
            console.log('=== LOADING CHAPTER ===');
            console.log('Chapter number:', chapterNumber);
            console.log('Current fanfic:', state.currentFanfic);
            
            if (!state.currentFanfic) {
                console.error('No current fanfic selected');
                chapterContent.innerHTML = '<h3>No Story Selected</h3><p>Please select a story to read.</p>';
                return;
            }
            
            if (!state.currentFanfic.chapters || state.currentFanfic.chapters.length === 0) {
                console.error('No chapters in this fanfic');
                chapterContent.innerHTML = '<h3>No Chapters</h3><p>This story has no chapters yet.</p>';
                return;
            }
            
            if (chapterNumber < 1 || chapterNumber > state.currentFanfic.chapters.length) {
                console.error('Chapter number out of range:', chapterNumber);
                chapterContent.innerHTML = '<h3>Chapter Not Found</h3><p>The requested chapter does not exist.</p>';
                return;
            }
            
            state.currentChapter = chapterNumber;
            const chapter = state.currentFanfic.chapters[chapterNumber - 1];
            
            console.log('Chapter to load:', chapter);
            console.log('Chapter title:', chapter.title);
            console.log('Chapter content:', chapter.content ? 'Content exists (' + chapter.content.length + ' chars)' : 'No content');
            
            // Update UI
            chapterSelect.value = chapterNumber;
            
            // SIMPLE DISPLAY - This should definitely work
            let html = `<h3>${chapter.title || 'Untitled Chapter'}</h3>`;
            
            if (chapter.content && chapter.content.trim()) {
                // Just show the content as-is with line breaks
                html += `<div class="chapter-text">${chapter.content.replace(/\n/g, '<br>')}</div>`;
            } else {
                html += '<p>No content available for this chapter.</p>';
            }
            
            chapterContent.innerHTML = html;
            console.log('Set chapter content HTML:', html);
            
            // Update button states
            prevChapter.disabled = chapterNumber === 1;
            nextChapter.disabled = chapterNumber === state.currentFanfic.chapters.length;
            
            // Force redraw
            chapterContent.style.display = 'none';
            setTimeout(() => {
                chapterContent.style.display = 'block';
            }, 10);
        }

        // Add new fanfic
        function addFanfic(title, summary, category, status, firstChapterTitle, firstChapterContent) {
            console.log('Adding new fanfic...');
            
            if (!firstChapterContent.trim()) {
                alert('Please write some content for your first chapter!');
                return;
            }
            
            const newFanfic = {
                id: state.nextFanficId++,
                title,
                author: state.currentUser.username,
                authorId: state.currentUser.id,
                summary,
                category,
                status,
                date: new Date().toISOString().split('T')[0],
                chapters: [
                    {
                        chapterNumber: 1,
                        title: firstChapterTitle,
                        content: firstChapterContent
                    }
                ]
            };
            
            console.log('New fanfic created:', newFanfic);
            
            state.fanfics.unshift(newFanfic);
            saveToStorage();
            
            // Navigate back to home
            navigateTo('home');
            
            // Show success message
            alert('Your fan fiction has been published successfully! Click on it to read your story.');
        }

        // Add chapter to existing fanfic
        function addChapterToFanfic(fanficId, chapterTitle, chapterContentText) {
            const fanfic = state.fanfics.find(f => f.id === fanficId);
            if (!fanfic) return;
            
            if (!chapterContentText.trim()) {
                alert('Please write some content for your chapter!');
                return;
            }
            
            // Ensure chapters array exists
            if (!fanfic.chapters) {
                fanfic.chapters = [];
            }
            
            const newChapter = {
                chapterNumber: fanfic.chapters.length + 1,
                title: chapterTitle,
                content: chapterContentText
            };
            
            fanfic.chapters.push(newChapter);
            saveToStorage();
            
            // Hide form and refresh
            addChapterForm.classList.remove('active');
            renderMyFics();
            
            // Show success message
            alert('Chapter added successfully!');
        }

        // Event Listeners

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM loaded, initializing...');
            
            // Clear localStorage for fresh start (optional)
            // localStorage.clear();
            
            initializeFromStorage();
            
            // Home button
            homeBtn.addEventListener('click', () => navigateTo('home'));
            
            // Navigation links
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    navigateTo(link.getAttribute('data-page'));
                });
            });
            
            // User actions
            loginBtn.addEventListener('click', () => loginModal.classList.add('active'));
            signupBtn.addEventListener('click', () => signupModal.classList.add('active'));
            logoutBtn.addEventListener('click', () => {
                state.currentUser = null;
                updateUserUI();
                saveToStorage();
                navigateTo('home');
            });
            
            // Modal controls
            closeLogin.addEventListener('click', () => loginModal.classList.remove('active'));
            closeSignup.addEventListener('click', () => signupModal.classList.remove('active'));
            switchToSignup.addEventListener('click', () => {
                loginModal.classList.remove('active');
                signupModal.classList.add('active');
            });
            switchToLogin.addEventListener('click', () => {
                signupModal.classList.remove('active');
                loginModal.classList.add('active');
            });
            
            // Login form
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('loginUsername').value;
                const password = document.getElementById('loginPassword').value;
                
                // Find user
                const user = state.users.find(u => u.username === username && u.password === password);
                
                if (user) {
                    state.currentUser = user;
                    updateUserUI();
                    saveToStorage();
                    loginModal.classList.remove('active');
                    loginForm.reset();
                    
                    // Navigate based on current page
                    if (state.currentPage === 'my-fics') {
                        renderMyFics();
                    }
                    
                    alert(`Welcome back, ${username}!`);
                } else {
                    alert('Invalid username or password.');
                }
            });
            
            // Signup form
            signupForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('signupUsername').value;
                const email = document.getElementById('signupEmail').value;
                const password = document.getElementById('signupPassword').value;
                const confirmPassword = document.getElementById('confirmPassword').value;
                
                // Validate
                if (password !== confirmPassword) {
                    alert('Passwords do not match.');
                    return;
                }
                
                if (password.length < 6) {
                    alert('Password must be at least 6 characters.');
                    return;
                }
                
                // Check if username exists
                if (state.users.some(u => u.username === username)) {
                    alert('Username already exists.');
                    return;
                }
                
                // Create new user
                const newUser = {
                    id: Date.now().toString(),
                    username,
                    email,
                    password
                };
                
                state.users.push(newUser);
                state.currentUser = newUser;
                updateUserUI();
                saveToStorage();
                signupModal.classList.remove('active');
                signupForm.reset();
                
                alert(`Account created successfully! Welcome, ${username}.`);
            });
            
            // Add fanfic buttons
            addFanficBtn.addEventListener('click', () => {
                if (!state.currentUser) {
                    alert('Please log in to create a fan fiction.');
                    loginModal.classList.add('active');
                } else {
                    navigateTo('add-fanfic');
                }
            });
            
            addFanficFooter.addEventListener('click', (e) => {
                e.preventDefault();
                if (!state.currentUser) {
                    alert('Please log in to create a fan fiction.');
                    loginModal.classList.add('active');
                } else {
                    navigateTo('add-fanfic');
                }
            });
            
            // Fanfic form
            fanficForm.addEventListener('submit', (e) => {
                e.preventDefault();
                if (!state.currentUser) {
                    alert('Please log in to create a fan fiction.');
                    loginModal.classList.add('active');
                    return;
                }
                
                const title = document.getElementById('title').value;
                const summary = document.getElementById('summary').value;
                const category = document.getElementById('category').value;
                const status = document.getElementById('status').value;
                const firstChapterTitle = document.getElementById('firstChapterTitle').value;
                const firstChapter = document.getElementById('firstChapter').value;
                
                addFanfic(title, summary, category, status, firstChapterTitle, firstChapter);
                fanficForm.reset();
                document.getElementById('firstChapterTitle').value = 'Chapter 1';
            });
            
            closeAddFanfic.addEventListener('click', () => navigateTo('home'));
            cancelBtn.addEventListener('click', () => navigateTo('home'));
            
            // Reader controls
            backToLibrary.addEventListener('click', () => navigateTo('library'));
            chapterSelect.addEventListener('change', () => loadChapter(parseInt(chapterSelect.value)));
            prevChapter.addEventListener('click', () => loadChapter(state.currentChapter - 1));
            nextChapter.addEventListener('click', () => loadChapter(state.currentChapter + 1));
            
            // Chapter form
            chapterForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const chapterTitle = document.getElementById('chapterTitle').value;
                const chapterContentText = document.getElementById('chapterContent').value;
                
                if (!state.currentFanfic) return;
                
                addChapterToFanfic(state.currentFanfic.id, chapterTitle, chapterContentText);
                chapterForm.reset();
            });
            
            cancelChapterBtn.addEventListener('click', () => {
                addChapterForm.classList.remove('active');
                chapterForm.reset();
            });
            
            // Filter buttons (event delegation)
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('filter-btn')) {
                    // Remove active class from all filter buttons
                    document.querySelectorAll('.filter-btn').forEach(btn => {
                        btn.classList.remove('active');
                    });
                    
                    // Add active class to clicked button
                    e.target.classList.add('active');
                    
                    // Get filter value
                    const filter = e.target.getAttribute('data-filter');
                    
                    // Filter logic would go here
                    // For now, just show all
                    renderFanfics(state.currentPage === 'home' ? 'home' : 'library');
                }
            });
            
            // Community links
            document.getElementById('communityGuidelines')?.addEventListener('click', (e) => {
                e.preventDefault();
                alert('Community Guidelines:\n\n1. Be respectful to other authors and readers\n2. Keep content appropriate (no explicit material)\n3. Credit inspiration when applicable\n4. No plagiarism\n5. Have fun and be creative!');
            });
            
            document.getElementById('aboutUs')?.addEventListener('click', (e) => {
                e.preventDefault();
                alert('About Shadow Slave Fan Fiction Hub:\n\nThis is a fan-made website created for Shadow Slave fans to share their stories. All rights to Shadow Slave belong to Guiltythree.\n\nThis site is not affiliated with the author or official publishers.');
            });
            
            document.getElementById('reportIssue')?.addEventListener('click', (e) => {
                e.preventDefault();
                alert('To report an issue, please email: shadow-slave-fanfic@example.com\n\nInclude details about the issue and steps to reproduce if possible.');
            });
            
            // Add emergency test button
            const emergencyTestBtn = document.createElement('button');
            emergencyTestBtn.textContent = 'TEST READER';
            emergencyTestBtn.style.position = 'fixed';
            emergencyTestBtn.style.bottom = '50px';
            emergencyTestBtn.style.right = '10px';
            emergencyTestBtn.style.zIndex = '9999';
            emergencyTestBtn.style.padding = '10px 15px';
            emergencyTestBtn.style.fontSize = '14px';
            emergencyTestBtn.style.backgroundColor = '#00ff00';
            emergencyTestBtn.style.color = 'black';
            emergencyTestBtn.style.border = 'none';
            emergencyTestBtn.style.borderRadius = '4px';
            emergencyTestBtn.style.cursor = 'pointer';
            emergencyTestBtn.style.fontWeight = 'bold';
            document.body.appendChild(emergencyTestBtn);
            
            emergencyTestBtn.addEventListener('click', () => {
                console.log('=== EMERGENCY TEST ===');
                
                // Create a test fanfic
                const testFanfic = {
                    id: 999,
                    title: "EMERGENCY TEST STORY",
                    author: "Test Author",
                    authorId: "test",
                    summary: "This is a test story to check if reader works",
                    category: "sunny",
                    status: "ongoing",
                    date: new Date().toISOString().split('T')[0],
                    chapters: [
                        {
                            chapterNumber: 1,
                            title: "Test Chapter 1",
                            content: "THIS IS A TEST. If you can see this text, the reader is working!\n\nThis is paragraph two of the test.\n\nAnd this is paragraph three. The text should be visible and readable."
                        }
                    ]
                };
                
                // Add to state and open reader
                state.currentFanfic = testFanfic;
                state.currentChapter = 1;
                
                // Update reader UI
                readerTitle.textContent = testFanfic.title;
                readerAuthor.textContent = `by ${testFanfic.author}`;
                
                // Populate chapter select
                chapterSelect.innerHTML = '';
                const option = document.createElement('option');
                option.value = 1;
                option.textContent = `Chapter 1: ${testFanfic.chapters[0].title}`;
                chapterSelect.appendChild(option);
                
                // Load chapter
                const chapter = testFanfic.chapters[0];
                let html = `<h3 style="color: red !important;">${chapter.title}</h3>`;
                html += `<div class="chapter-text" style="color: white !important; font-size: 20px !important; background-color: rgba(255,0,0,0.1); padding: 20px; border: 2px solid red;">`;
                html += `<p><strong>TEST TEXT:</strong> ${chapter.content.replace(/\n/g, '<br>')}</p>`;
                html += `<p><strong>If you can see this, the reader works!</strong></p>`;
                html += `</div>`;
                
                chapterContent.innerHTML = html;
                
                // Navigate to reader
                navigateTo('reader');
                
                alert('Test story loaded. You should see RED TEST TEXT in the reader.');
            });
        });
    </script>
</body>
</html>
